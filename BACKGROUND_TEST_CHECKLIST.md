# 📱 CamCon 백그라운드 이벤트 리스너 테스트 체크리스트

## 🔧 사전 준비

### 1. 권한 설정 확인

- [ ] USB 권한 승인됨
- [ ] 저장소 권한 승인됨
- [ ] **배터리 최적화 예외 설정됨** ⭐ 중요!
- [ ] 알림 권한 승인됨

### 2. 카메라 연결 확인

- [ ] USB 케이블로 카메라 연결
- [ ] 카메라 전원 ON
- [ ] 앱에서 카메라 연결 상태 "연결됨" 표시
- [ ] 이벤트 리스너 "활성" 상태 확인

## 🧪 테스트 시나리오

### 테스트 1: 기본 백그라운드 테스트

1. **준비**
    - [ ] 앱 실행
    - [ ] 카메라 제어 탭에서 연결 확인
    - [ ] 로그에서 "✅ 이벤트 리스너 시작 성공" 메시지 확인

2. **백그라운드 진입**
    - [ ] 홈 버튼 눌러서 앱 백그라운드로 보냄
    - [ ] 알림창에서 "CamCon 백그라운드 동기화" 알림 확인
    - [ ] 알림 텍스트: "카메라 이벤트 리스너 활성 - 사진 수신 대기 중"

3. **사진 촬영 테스트**
    - [ ] 카메라에서 사진 1장 촬영
    - [ ] 3초 내에 알림 또는 진동으로 수신 확인
    - [ ] 갤러리에서 사진 확인

4. **결과 확인**
    - [ ] ✅ 성공: 백그라운드에서 사진 수신
    - [ ] ❌ 실패: 로그 확인 필요

### 테스트 2: 화면 잠금 테스트

1. **준비**
    - [ ] 앱 실행 → 카메라 연결 확인
    - [ ] 백그라운드 서비스 알림 확인

2. **화면 잠금**
    - [ ] 전원 버튼 눌러서 화면 잠금
    - [ ] 1분 대기 (도즈 모드 진입 시간)

3. **사진 촬영**
    - [ ] 카메라에서 사진 2-3장 연속 촬영
    - [ ] 화면 켜서 사진 수신 확인

4. **결과 확인**
    - [ ] ✅ 성공: 화면 잠금 상태에서 사진 수신
    - [ ] ❌ 실패: Wake Lock 문제 가능성

### 테스트 3: 장시간 백그라운드 테스트

1. **준비**
    - [ ] 앱 실행 → 카메라 연결
    - [ ] 앱 백그라운드로 보냄

2. **장시간 대기**
    - [ ] 5분 대기
    - [ ] 알림에서 "카메라 이벤트 리스너 활성" 상태 확인
    - [ ] 카메라 사진 촬영 → 수신 확인
    - [ ] 10분 대기
    - [ ] 다시 카메라 사진 촬영 → 수신 확인

3. **결과 확인**
    - [ ] ✅ 성공: 장시간 백그라운드에서도 작동
    - [ ] ❌ 실패: Wake Lock 갱신 문제 가능성

### 테스트 4: 앱 완전 종료 테스트

1. **준비**
    - [ ] 앱 실행 → 카메라 연결
    - [ ] 백그라운드 서비스 알림 확인

2. **앱 강제 종료**
    - [ ] 최근 앱에서 CamCon 완전 종료 (위로 스와이프)
    - [ ] 알림창에서 백그라운드 서비스 알림 여전히 있는지 확인

3. **사진 촬영**
    - [ ] 카메라에서 사진 촬영
    - [ ] 갤러리에서 사진 수신 확인

4. **결과 확인**
    - [ ] ✅ 성공: 앱 종료 후에도 사진 수신
    - [ ] ❌ 실패: Foreground Service 문제 가능성

### 테스트 5: 도즈 모드 강제 테스트 (ADB 필요)

1. **ADB 연결**
    - [ ] `adb devices`로 디바이스 연결 확인
    - [ ] 앱 실행 → 카메라 연결 → 백그라운드로 보냄

2. **도즈 모드 강제 진입**
    - [ ] `adb shell dumpsys deviceidle force-idle`
    - [ ] 로그에서 도즈 모드 진입 확인
    - [ ] 카메라 사진 촬영

3. **도즈 모드 해제 후 확인**
    - [ ] `adb shell dumpsys deviceidle unforce`
    - [ ] 갤러리에서 사진 확인

4. **결과 확인**
    - [ ] ✅ 성공: 도즈 모드에서도 사진 수신
    - [ ] ❌ 실패: 배터리 최적화 예외 설정 필요

### 테스트 6: 재부팅 테스트

1. **준비**
    - [ ] 앱 실행 → 카메라 연결 확인
    - [ ] 폰 재부팅

2. **재부팅 후**
    - [ ] 자동으로 백그라운드 서비스 알림 뜨는지 확인
    - [ ] 카메라 연결 (USB 재연결)
    - [ ] 앱 실행하지 말고 바로 사진 촬영

3. **결과 확인**
    - [ ] ✅ 성공: 재부팅 후에도 자동으로 서비스 시작
    - [ ] ❌ 실패: BootReceiver 문제 가능성

## 🔍 로그 모니터링 방법

### Android Studio Logcat 필터

```
tag:BackgroundSyncService OR tag:카메라이벤트매니저 OR tag:BootReceiver OR 이벤트.*리스너 OR Wake.*Lock
```

### ADB 로그 모니터링

```bash
adb logcat | grep -E "(BackgroundSyncService|이벤트.*리스너|Wake.*Lock|사진.*촬영.*감지)"
```

### 주요 성공 로그 메시지들

- ✅ `Wake Lock 획득 - 백그라운드 이벤트 리스너 유지`
- ✅ `백그라운드 이벤트 리스너 관리자 시작`
- ✅ `카메라 연결 및 이벤트 리스너 정상 작동 중`
- ✅ `외부 셔터 사진 촬영 감지: [파일명]`
- ✅ `부팅 후 백그라운드 서비스 시작 성공`

### 주요 오류 로그 메시지들

- ❌ `Wake Lock 획득 실패`
- ❌ `백그라운드에서 이벤트 리스너 재시작 실패`
- ❌ `카메라 연결되지 않음`
- ❌ `백그라운드 서비스 시작 실패`

## 🚨 문제 해결

### 사진이 수신되지 않는 경우

1. **배터리 최적화 예외 설정 확인**
    - 설정 → 앱 → CamCon → 배터리 → "최적화하지 않음"

2. **백그라운드 서비스 상태 확인**
    - 알림창에서 "CamCon 백그라운드 동기화" 알림 있는지 확인

3. **카메라 연결 상태 확인**
    - USB 케이블 재연결
    - 카메라 전원 확인

4. **권한 재확인**
    - 저장소 권한, USB 권한 등

### Wake Lock 문제

- 로그에서 "Wake Lock 갱신됨" 메시지 확인
- 배터리 설정에서 "적응형 배터리" 비활성화 고려

### 도즈 모드 문제

- "배터리 사용량 최적화" 예외 설정 필수
- 제조사별 추가 배터리 설정 확인 (삼성: 절전 모드, LG: 스마트 절전 등)

## ✅ 테스트 완료 체크리스트

- [ ] 기본 백그라운드에서 사진 수신 ✅
- [ ] 화면 잠금 상태에서 사진 수신 ✅
- [ ] 장시간(10분+) 백그라운드에서 작동 ✅
- [ ] 앱 종료 후에도 사진 수신 ✅
- [ ] 도즈 모드에서 사진 수신 ✅
- [ ] 재부팅 후 자동 서비스 시작 ✅

**모든 테스트 통과 시**: 🎉 백그라운드 이벤트 리스너 완벽 작동!